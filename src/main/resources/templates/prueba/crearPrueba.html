<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="ISO-8859-1">
<title>Crear Pruebas</title>

<link rel="stylesheet"
	href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"
	integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO"
	crossorigin="anonymous">

<style>
.cabezal {
	display: flex;
	flex-direction: row;
	align-items: center;
}

.preguntas {
	display: flex;
	flex-direction: row;
	align-items: start;
}
</style>

<script	src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="/js/jquery.tabletojson.min.js"></script>


<script type="text/javascript">
	//Con este codigo js invoco al servidor solo para pedir la porción de la página que contiene las 
	//preguntas filtradas según el criterio del usuario 

	function filtrarPreguntas() {
		var url = '/prueba/filtrarPreguntas';
		url = url + '/materia/' + $('#materias-combo').val();
		url = url + '/tema/' + $('#temas-combo').val();

		$("#preguntas-filtradas").load(url);
	}

	//esta función lo que hace es construir a mano el html que representa una fila de la tabla
	function agregarPregunta(idPreg, enunciado) {
		var colId = '<td>' + idPreg + '</td>';
		var colEnunciado = '<td>' + enunciado + '</td>';
		var colNotas = '<td> <input type="text" size="2" value="1"></td>';
		var botonBorrar = '<td><a class="btn btn-warning btn-sm" id="botonBorrar" onclick="quitar(this)">Quitar</a></td>'

		var fila = '<tr>' + colId + colEnunciado + colNotas + botonBorrar
				+ '</tr>';

		//agrega fila a la tabla
		$('#tabla-preguntas tr:last').after(fila);
	}

	function quitar(boton) {
		var p = boton.parentNode.parentNode;
		p.parentNode.removeChild(p);
	}

	function enviarPreguntas() {
		var data = $('#tabla-preguntas').tableToJSON();
		var url = 'http://'+window.location.host +'/prueba/guardarPrueba';
		
		fetch(url, {
			  method: "POST",
			  body: JSON.stringify(data),
			  headers: {"Content-type": "application/json; charset=UTF-8"}
			})

	}
</script>

</head>
<body>
	<div class="cabezal">
		<div class="container my-2" align="center">

			<div class="card">
				<h5 class="card-header">Nueva prueba</h5>
				<div class="card-body">
					<div class="input-group input-group-sm mb-3">
						<div class="input-group-prepend">
							<span class="input-group-text" id="inputGroup-sizing-sm">Titulo</span>
						</div>
						<input type="text" class="form-control" aria-label="Small"
							aria-describedby="inputGroup-sizing-sm"
							th:text="${prueba.titulo}">
					</div>

					<div class="input-group input-group-sm mb-3">
						<div class="input-group-prepend">
							<span class="input-group-text" id="inputGroup-sizing-sm">Descripcion</span>
						</div>
						<input type="text" class="form-control" aria-label="Small"
							aria-describedby="inputGroup-sizing-sm" th:text="${prueba.desc}">
					</div>
					<button type="submit" class="btn btn-primary"
						onclick="enviarPreguntas()">Guardar</button>
						
				</div>
			</div>

		</div>
		<div class="container my-2" align="center">
			<div class="card">
				<h5 class="card-header">Filtro preguntas</h5>
				<div class="card-body">

					<div class="input-group mb-3">
						<div class="input-group-prepend">
							<select id="materias-combo" class="form-select form-select-sm"
								aria-label=".form-select-sm example" th:field="*{materias}"
								onchange="filtrarPreguntas()">
								<option th:each="materia : ${materias}" th:value="${materia.id}"
									th:text="${materia.desc}"></option>
							</select>
						</div>
					</div>

					<div class="input-group mb-3">
						<div class="input-group-prepend">
							<select id="temas-combo" class="form-select form-select-sm"
								aria-label=".form-select-sm example" th:field="*{temas}"
								onchange="filtrarPreguntas()">
								<option th:each="tema : ${temas}" th:value="${tema.id}"
									th:text="${tema.desc}"></option>
							</select>
						</div>
					</div>

				</div>

			</div>

		</div>

	</div>


	<div class="preguntas">
		<div class="container my-2" align="center">
			<div id="preguntas-seleccionadas" class="seccion-preguntas">
			
				<table id="tabla-preguntas" border="1"
					class="table table-striped table-sm">
					<thead class="thead-dark">
						<tr>
							<th>Id</th>
							<th>Pregunta</th>
							<th>Puntos</th>
							<th></th>
						</tr>
					</thead>
					<tbody>
						<!-- las filas de esta tablas se agragan por js al apretar el boton "agregar" -->
					</tbody>
				</table>
			</div>
		</div>

		<div class="container my-2" align="center">
			<div id="preguntas-filtradas" class="seccion-preguntas">
				<!-- Esta parte se carga cuando el usuario hace click en el boton filtrar -->

			</div>
		</div>
	</div>

</body>
</html>
